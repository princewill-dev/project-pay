{% extends 'home/main.html' %}

{% load static %}

{% block content %}


{% include 'home/navbar.html' %}
  
{% include 'home/mobile-nav.html' %}

{% include 'home/mobile-sidebar.html' %}

<!--===== WELCOME STARTS =======-->
<!-- <div class="about-welcome-section-area about2" style="background-image: url(/static/onboarding/assets/images/background/header2-bg.png); background-repeat: no-repeat; background-size: cover;">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 m-auto">
                <div class="about-welcome-header text-center heading3">
                    <h1>Pricing Plan</h1>
                    <div class="space16"></div>
                    <a href="index.html">Home <i class="fa-solid fa-angle-right"></i> <span>Pricing Plan</span></a>
                </div>
            </div>
        </div>
    </div>
</div> -->
<!--===== WELCOME ENDS =======-->


<style>
  .card-header {
      background-color: #f8f9fa;
      font-weight: bold;
  }
  .card-body {
      padding: 1.25rem;
  }
  .store-card {
      cursor: pointer;
      transition: background-color 0.3s ease;
  }
  .store-card:hover {
      background-color: #f8f9fa;
  }
</style>





<!--===== PRICING PLAN AREA STARTS =======-->
<div class="pricing-paln-section-area pricing2 sp6 bg-none">
    <div class="container">
      <div class="row">
        <div class="col-lg-7 m-auto">
          <div class="pricing-header text-center heading6">
            <div class="space16"></div>
            <div class="space16"></div>
            <div class="space16"></div>
            <div class="space16"></div>
            <div class="space16"></div>
            <!-- <h3 class="text-white">Welcome to your dashboard</h3>
            <div class="space16"></div> -->
            <p class="text-white"><span style="color: rgb(60, 147, 118);">user: {{ account_email }}</span></p>
            
          </div>
        </div>
      </div>
      <!-- <div class="space60"></div> -->
      <div class="pricing-plans">
        <div class="container">
          
          <div class="tab-content">
            <div class="row my-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">Dashboard Overview</div>
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <span style="font-size: 16px;">Total Earnings: ${{ total_successful_transactions }}</span>
                            <!-- <span style="font-size: 16px;">Gross Total: $150,000</span> -->
                        </div>
                    </div>
                </div>
            </div>
          </div>
          
          <p class="text-center" style="color: #818080; font-size: 16px;">---- your stores ----</p>
          <div class="space16"></div>

          <div class="tab-content">

            <div class="row">

              {% for link in payment_links %}

                <div class="col-md-4">
                  <div class="price-box">
                    <div class="">
                      <div class="pricing-area" style="padding: 20px; border-radius: 5px;">
                        <span style="font-size: 16px;">ID: {{ link.link_id }}</span>
                        <hr>
                        <h3 style="font-size: 20px;">
                          {% if link.link_logo %}
                            <img src="{{link.link_logo.url}}" alt="" width="50px" height="50px" style="border-radius: 3px; border: 2px solid #000;">
                          {% endif %}
                          {{ link.tag_name }}
                          
                        </h3>
                        <div class="space16"></div>

                        <p style="font-size: 16px;">Earnings: ${{ link.total_successful_transactions }}</p>
                        
                        <p style="font-size: 16px;">
                          Accepting:
                          {% for wallet in link.wallet_set.all %}
                            {{ wallet.crypto }},
                          {% endfor %}
                        </p>
                        <hr>
                        <div>
                          <a href="{% url 'create_invoice_via_storelink' link_id=link.link_id %}" style="font-size: 16px; color: #333; padding: 10px; border-radius: 5px; margin: 5px;">create invoice</a>
                          |
                          <a href="{% url 'show_payment_link' link_id=link.link_id %}" style="font-size: 16px; color: #333; padding: 10px; border-radius: 5px; margin: 5px;">manage store</a>
                          <!-- |
                          <a href="{% url 'delete_payment_link' link_id=link.link_id %}" style="font-size: 16px; color: #333; padding: 10px; border-radius: 5px; margin: 5px;" onclick="return confirm('Are you sure you want to delete this link?');">delete</a> -->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
  
              {% empty %}
                <div class="space16"></div>
                <div class="space16"></div>

                <div class="text-center">
                    <p style="color: #fff; text-align: center; font-size: 16px;">You have no store yet.</p>
                    <!-- <br>
                    <a href="{% url 'create_payment_link' %}" target="_blank" class="header-btn1">Create link</a> -->
                    <div class="space16"></div>
                </div>

              {% endfor %}

              <div class="text-center">
                <a href="{% url 'create_payment_link' %}" class="header-btn">create new store</a>
              </div>
              <div class="space16"></div>
              <div class="space16"></div>

            </div>

            <div class="space16"></div>
            <div class="space16"></div>

            <div class="container" style="background-color: #fff; border-radius: 3px; padding: 10px;">
              <div class="space16"></div>
              <h5 class="text-center">Transactions</h5>
              <div class="space16"></div>
              <div class="">

                {% if transactions %}

                  <table class="table table-bordered table-striped" style="font-size: 14px;">
                    <thead>
                      <tr>
                        <th>Amount</th>
                        <th>Store</th>
                        <th>Status</th>
                        <th>Date</th>
                        <!-- <th>Details</th> -->
                      </tr>
                    </thead>
                    <tbody>
                      {% for transaction in transactions %}
                      
                        <tr style="font-size: 12px;">
							<td>${{ transaction.amount }}</td>

							<td>{{ transaction.payment_link.tag_name }}</td>

							{% if transaction.status == 'successful' %}
								<td style="color: green;">✅</td>
							{% else %}
								<td style="color: red;">⏳</td>
							{% endif %}
							
								<td>{{ transaction.created_at|date:"d-m-Y g:i a" }}</td>

							<!-- {% if transaction.transaction_hash == None %}
								<td>link unavailable</td>
							{% else %}
								<td>
								<a href="{{ transaction.transaction_hash }}" target="_blank">view</a>
								</td>
							{% endif %} -->

                        </tr>
                        
                      {% endfor %}
                    </tbody>
                  </table>
                {% else %}
                    <div class="text-center">
                        <p style="color: #000; text-align: center; font-size: 16px;">You haven't made any transactions yet.</p>
                    </div>
                {% endif %}

              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>
  <!--===== PRICING PLAN AREA ENDS =======-->

  {% endblock %}