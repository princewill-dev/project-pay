{% extends 'home/main.html' %}

{% load static %}

{% block content %}

{% include 'home/navbar.html' %}
  
{% include 'home/mobile-nav.html' %}

{% include 'home/mobile-sidebar.html' %}

<!--===== WELCOME STARTS =======-->


<div class="about-welcome-section-area login" style="background-image: url(/static/onboarding/assets/images/background/emailbg.png); background-repeat: no-repeat; background-size: cover;">
    <div class="space16"></div>
    <div class="container">
        <div class="row">

            {% if messages %}
                {% for message in messages %}

                <center>
                    <p id="notify" class="alert alert-info" style="font-size: 12px;">{{ message }}</p>
                </center>
                
                <script>
                    // Get the element you want to disappear
                    const element = document.getElementById('notify');

                    // Set a timeout to hide the element after 3 seconds
                    setTimeout(function() {
                    element.style.display = 'none';
                    }, 5000);
                </script>

                {% endfor %}
            {% endif %}

            <div class="about-welcome-header text-center heading3">
                <a href="{% url 'dashboard' %}">Dashboard <i class="fa-solid fa-angle-right"></i> <span>store view</span></a>
            </div>

            <div class="space16"></div>
            <div class="space16"></div>

            <div class="col-md-6 m-auto">
                <div class="price-box" style="background-color: #fff;">
                  <div class="">
                    <div class="pricing-area" style="padding: 20px; border-radius: 5px;">
                      <span style="font-size: 16px;">Store ID: {{ payment_link.link_id }}</span>
                      <hr>
                      <h3 style="font-size: 20px;">
                        {% if payment_link.link_logo %}
                          <img src="{{payment_link.link_logo.url}}" alt="" width="50px" height="50px" style="border-radius: 3px; border: 2px solid #000;">
                        {% endif %}

                        {{ payment_link.tag_name }}
                        
                      </h3>
                      <div class="space16"></div>

                      <p style="font-size: 16px;">Earnings: ${{ total_successful_payments }}</p>
                      
                      <p style="font-size: 16px;">
                        This store accepts:
                        <br>
                        {% for wallet in payment_link.wallet_set.all %}
                          {{ wallet.crypto }}:{{ wallet.address }} <br>
                        {% endfor %}
                      </p>
                      <hr>
                      <div>
                        <a href="{% url 'create_invoice_via_storelink' link_id=payment_link.link_id %}" style="font-size: 16px; color: #333; padding: 10px; border-radius: 5px; margin: 5px;">create invoice</a>
                        |
                        <a href="{% url 'edit_payment_link' link_id=payment_link.link_id %}" style="font-size: 16px; color: #333; padding: 10px; border-radius: 5px; margin: 5px;">edit info</a>
                        |
                        <a href="{% url 'edit_payment_wallets' link_id=payment_link.link_id %}" style="font-size: 16px; color: #333; padding: 10px; border-radius: 5px; margin: 5px;">edit wallets</a>
                        |
                        <a href="{% url 'delete_payment_link' link_id=payment_link.link_id %}" style="font-size: 16px; color: #333; padding: 10px; border-radius: 5px; margin: 5px;" onclick="return confirm('Are you sure you want to delete this link?');">delete</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

        </div>
    </div>
</div>
<!--===== WELCOME ENDS =======-->


<div class="container" style="background-color: #fff; border-radius: 3px; padding: 10px;">
    <div class="space16"></div>
    <h5 class="text-center">Transactions</h5>
    <div class="space16"></div>
    <div class="table-responsive">

    {% if transactions %}

        <table class="table table-bordered table-striped" style="font-size: 16px;">
        <thead>
            <tr>
            <th>Amount</th>
            <th>Store</th>
            <th>Status</th>
            <th>Date</th>
            <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transactions %}

                <tr>
                <td>${{ transaction.amount }}</td>

                <td>{{ transaction.payment_link.tag_name }}</td>

                {% if transaction.status == 'successful' %}
                    <td style="color: green;">✅</td>
                {% else %}
                    <td style="color: red;">⏳</td>
                {% endif %}
                
                <td>{{ transaction.created_at }}</td>
                {% if transaction.transaction_hash == None %}
                    <td>link unavailable</td>
                {% else %}
                    <td>
                    <a href="{{ transaction.transaction_hash }}" target="_blank">view</a>
                    </td>
                {% endif %}
                </tr>
            
            {% endfor %}
        </tbody>
            {% else %}
                <div class="text-center">
                    <p style="color: #fff; text-align: center;">You haven't made any transactions yet.</p>
                </div>
            {% endif %}
        </table>

    </div>
</div>


{% endblock %}